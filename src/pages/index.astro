---
import "../styles/global.css";
import SiteHeader from "../components/SiteHeader.astro";
import HeroCarousel from "../components/HeroCarousel.astro";
import PropertyBlock from "../components/PropertyBlock.astro";
import SiteFooter from "../components/SiteFooter.astro";
import { properties } from "../data/properties.js";

// Group properties by city
const groups = properties.reduce((acc, p) => {
  const key = p.city || "Other";
  (acc[key] ||= []).push(p);
  return acc;
}, {});

// Order cities
const cityOrder = ["Panama City Beach, FL", "Destin, FL"];
const orderedCities = [
  ...cityOrder.filter((c) => groups[c]),
  ...Object.keys(groups).filter((c) => !cityOrder.includes(c)),
];

// Helper: pull a stable slug from p.href (e.g. "/properties/heavenly-hideaway/")
const slugFromHref = (href = "") =>
  href.replace(/^\/+|\/+$/g, "").split("/").pop() || "";
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Coastal Beach Retreats</title>
    <meta
      name="description"
      content="Discover Coastal Beach Retreats â€“ luxury beachfront vacation rentals in Panama City Beach and Destin."
    />
    <style>
      body {
        margin: 0;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        line-height: 1.5;
      }
    </style>
  </head>

  <body>
    <SiteHeader phone="(918) 734-3331" />

    <HeroCarousel />

    <section class="brand-divider">
      <img
        src="/images/coastal-beach-retreats-welcome.png"
        alt="Welcome to Coastal Beach Retreats"
        loading="eager"
      />
    </section>

    <!-- Location switcher (jump to featured properties) -->
    <nav class="location-switcher" aria-label="Browse by location">
      <p class="location-label">Browse by location</p>
      <div class="location-buttons">
        <a class="loc-btn" href="#heavenly-hideaway">Panama City Beach</a>
        <a class="loc-btn" href="#destin-dreams">Destin</a>
      </div>
    </nav>

    <!-- Properties -->
    {orderedCities.map((city) => (
      <section style="max-width:1120px;margin:0 auto;padding:14px;">
        {/* Keep Destin city heading only */}
        {city === "Destin, FL" && <h2 class="city-heading">{city}</h2>}

        {groups[city].map((p) => {
          const slug = slugFromHref(p.href);

          // Set anchors based on slug (stable)
          const anchorId =
            slug === "heavenly-hideaway"
              ? "heavenly-hideaway"
              : slug === "destin-dreams"
              ? "destin-dreams"
              : undefined;

          return (
            <div id={anchorId} style="scroll-margin-top: 90px;">
              <PropertyBlock p={p} />
            </div>
          );
        })}
      </section>
    ))}

    <section style="max-width:1120px;margin:0 auto;padding:14px;" id="reviews">
      <h2 style="margin:0 0 8px;">Guest Reviews</h2>
      <hr style="border:0;border-top:1px solid rgba(0,0,0,.10);margin:12px 0 16px;" />

      <div
        class="ownerrez-widget"
        data-widget-type="Reviews - Reviews"
        data-widgetId="4bf99f90fcf54552a13fd7315759dbca"
      ></div>

      <script is:inline src="https://app.ownerrez.com/widget.js"></script>
    </section>

    <SiteFooter phone="(918) 734-3331" email="coastalbeachretreats@gmail.com" />
  </body>
</html>
