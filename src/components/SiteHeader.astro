---
const { phone = "(918) 734-3331" } = Astro.props;

const telHref = `tel:${phone.replace(/[^0-9]/g, "")}`;

const propertyLinks = [
  { href: "/properties/heavenly-hideaway/", label: "Heavenly Hideaway @ Edgewater Tower 1-1106 Panama City Beach, FL" },
  { href: "/properties/sailors-delight/", label: "Sailor's Delight @ Edgewater Tower 1-911 Panama City Beach, FL" },
  { href: "/properties/red-sky-nights/", label: "Red Sky Nights @ Edgewater Tower 1-1002 Panama City Beach, FL" },
  { href: "/properties/destin-dreams/", label: "Destin Dreams @ Sterling Shores 311 Destin, FL" }
];

// Update this to your actual logo path:
const logoSrc = "/images/logo.png";
---

<header class="hdr" data-header>
  <div class="bar">
    <!-- LEFT: full nav (hidden when collapsed) + hamburger (shown when collapsed) -->
    <div class="left">
      <button class="hamburger" type="button" aria-label="Open menu" aria-expanded="false">
        ☰
      </button>

      <!-- Quote button that ONLY appears when collapsed -->
      <a class="quote quoteLeft" href="/quote/">QUOTE / PRICING</a>

      <nav class="nav" aria-label="Primary">
        <a class="link" href="/">Home</a>

        <div class="dropdown">
          <button class="link dropbtn" type="button">
            Properties ▾
          </button>
          <div class="menu">
            {propertyLinks.map(p => (
              <a href={p.href}>{p.label}</a>
            ))}
          </div>
        </div>

        <a class="link" href="/3d-condo-tours/">3D Condo Tours</a>
        <a class="link" href="/map/">Map</a>
        <a class="link" href="/availability/">Availability</a>
        <a class="link" href="/reviews/">Reviews</a>
      </nav>
    </div>

    <!-- RIGHT: quote on desktop + phone always + logo only when collapsed -->
    <div class="right">
      <!-- Quote button that appears on full width (desktop) -->
      <a class="quote quoteRight" href="/quote/">QUOTE / PRICING</a>

      <span class="pipe hideOnCollapse">|</span>
      <a class="contact hideOnCollapse" href={telHref}>{phone}</a>


      <a class="logo" href="/" aria-label="Home">
        <img src={logoSrc} alt="Coastal Beach Retreats" />
      </a>
    </div>
  </div>

  <div class="cutout" aria-hidden="true"></div>

  <!-- Collapsed drawer menu (only shown when hamburger toggled) -->
  <div class="drawer" aria-label="Collapsed menu">
    <a class="dlink" href="/">Home</a>

    <details class="dprops">
      <summary>Properties</summary>
      <div class="dmenu">
        {propertyLinks.map(p => (
          <a class="dlink" href={p.href}>{p.label}</a>
        ))}
      </div>
    </details>

    <a class="dlink" href="/3d-condo-tours/">3D Condo Tours</a>
    <a class="dlink" href="/map/">Map</a>
    <a class="dlink" href="/availability/">Availability</a>
    <a class="dlink" href="/reviews/">Reviews</a>
    <a class="dlink" href="/quote/">Quote / Pricing</a>
  </div>

  <script>
    // Find the nearest header for THIS component without using document.currentScript
    const header = document.querySelector("header.hdr[data-header]") || document.querySelector("header.hdr");
    if (!header) {
      console.warn("Hamburger menu: header not found");
    } else {
      const btn = header.querySelector(".hamburger");
      const drawer = header.querySelector(".drawer");

      if (!btn || !drawer) {
        console.warn("Hamburger menu: missing .hamburger or .drawer");
      } else {
        const setOpen = (open) => {
          drawer.classList.toggle("open", open);
          btn.setAttribute("aria-expanded", String(open));
          btn.textContent = open ? "✕" : "☰";
        };

        btn.addEventListener("click", (e) => {
          e.preventDefault();
          setOpen(!drawer.classList.contains("open"));
        });

        drawer.addEventListener("click", (e) => {
          const a = e.target.closest("a");
          if (a) setOpen(false);
        });

        document.addEventListener("keydown", (e) => {
          if (e.key === "Escape") setOpen(false);
        });

        const mq = window.matchMedia("(min-width: 1101px)");
        mq.addEventListener("change", (e) => {
          if (e.matches) setOpen(false);
        });
      }
    }
  </script>

  <style>
    .cutout {
        display: none;
        max-width: 1120px;
        margin: 0 auto;
        height: 64px;
        background: #fff;
        border-left: 1px solid rgba(0,0,0,.12);
        border-right: 1px solid rgba(0,0,0,.12);
        border-bottom: 1px solid rgba(0,0,0,.12);
        border-bottom-left-radius: 14px;
        border-bottom-right-radius: 14px;

        /* angled “divet” look */
        clip-path: polygon(0 0, 78% 0, 100% 100%, 0 100%);
        }

    @media (max-width: 1100px) {
        .cutout { display: block; }
    }

    .hdr {
      position: sticky;
      top: 0;
      z-index: 50;
      background: #fff;
      border-bottom: 1px solid rgba(0,0,0,.12);
    }

    .hideOnCollapse { display: inline; }

    @media (max-width: 1100px) {
    .hideOnCollapse { display: none; }
    }

    .bar {
      max-width: 1120px;
      margin: 0 auto;
      padding: 10px 14px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 14px;
    }

    .left {
      display: flex;
      align-items: center;
      gap: 12px;
      min-width: 0;
    }

    .nav {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
      min-width: 0;
    }

    .link {
      text-decoration: none;
      padding: 8px 10px;
      border-radius: 10px;
    }

    .link:hover { background: rgba(0,0,0,.04); }

    .right {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: nowrap;
      font-size: 14px;
    }

    .quote {
      text-decoration: none;
      padding: 8px 12px;
      border-radius: 12px;
      border: 1px solid rgba(0,0,0,.18);
      font-weight: 600;
      white-space: nowrap;
    }

    /* Default: quote on RIGHT, hidden on LEFT */
    .quoteLeft { display: none; }
    .quoteRight { display: inline-flex; }

    .contact {
      text-decoration: underline;
      text-underline-offset: 3px;
      white-space: nowrap;
    }

    .pipe { opacity: .4; }

    /* Logo: hidden normally, shown when collapsed */
    .logo { display: none; text-decoration: none; }
    .logo img { height: 44px; width: auto; display: block; }

    /* Hamburger: hidden normally, shown when collapsed */
    .hamburger {
      display: none;
      width: 44px;
      height: 44px;
      border-radius: 10px;
      border: 1px solid rgba(0,0,0,.18);
      background: rgba(0,0,0,.04);
      cursor: pointer;
      font-size: 22px;
      line-height: 1;
    }

    /* Dropdown (desktop/full nav) */
    .dropdown { position: relative; }
    .dropbtn { background: none; border: 0; cursor: pointer; font: inherit; }
    .menu {
      display: none;
      position: absolute;
      top: calc(100% + 8px);
      left: 0;
      min-width: 360px;
      background: #fff;
      border: 1px solid rgba(0,0,0,.12);
      border-radius: 12px;
      padding: 6px;
      box-shadow: 0 12px 28px rgba(0,0,0,.10);
    }
    .menu a {
      display: block;
      padding: 10px;
      border-radius: 10px;
      text-decoration: none;
    }
    .menu a:hover { background: rgba(0,0,0,.04); }
    .dropdown:hover .menu { display: block; }

    /* Drawer (collapsed menu) */
    .drawer {
      position: relative;
      z-index: 60;
      display: none;
      max-width: 1120px;
      margin: 0 auto;
      padding: 10px 14px 14px;
      border-top: 1px solid rgba(0,0,0,.12);
      background: #fff;
    }
    .drawer.open { display: block; }
    .dlink {
      display: block;
      padding: 10px 6px;
      border-radius: 10px;
      text-decoration: none;
    }
    .dlink:hover { background: rgba(0,0,0,.04); }

    .dprops summary {
      cursor: pointer;
      padding: 10px 6px;
      border-radius: 10px;
      list-style: none;
    }
    .dprops summary:hover { background: rgba(0,0,0,.04); }
    .dprops summary::-webkit-details-marker { display: none; }
    .dmenu { padding-left: 10px; }

    /* Collapse breakpoint */
    @media (max-width: 1100px) {
      .nav { display: none; }
      .hamburger { display: inline-flex; align-items: center; justify-content: center; }
      .logo { display: inline-flex; align-items: center; }

      /* Swap quote position ONLY when collapsed */
      .quoteLeft { display: inline-flex; }
      .quoteRight { display: none; }
    }

    @media (max-width: 520px) {
      .pipe { display: none; }
      .right { gap: 8px; }
      .quote { padding: 8px 10px; }
      .logo img { height: 40px; }
    }
  </style>
</header>
